{"ast":null,"code":"var _jsxFileName = \"E:\\\\EMS\\\\frontend\\\\src\\\\context\\\\AuthContext.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect, useCallback } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nconst TOKEN_KEY = process.env.REACT_APP_TOKEN_KEY || \"auth_token\";\n\n// Helper to safely access localStorage\nconst getLocalStorage = () => {\n  if (typeof window !== \"undefined\" && window.localStorage) {\n    return window.localStorage;\n  }\n  return null;\n};\n\n// Parse JWT token to get user info\nconst parseJwt = token => {\n  try {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {\n      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n    }).join(''));\n    return JSON.parse(jsonPayload);\n  } catch (error) {\n    console.error('Error parsing JWT token:', error);\n    return null;\n  }\n};\n\n// Check if token is expired\nconst isTokenExpired = token => {\n  try {\n    const decoded = parseJwt(token);\n    if (!decoded || !decoded.exp) return true;\n\n    // Check if expiration time is in the past (in seconds)\n    const currentTime = Math.floor(Date.now() / 1000);\n    return decoded.exp < currentTime;\n  } catch (error) {\n    console.error('Error checking token expiration:', error);\n    return true;\n  }\n};\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n\n  // Initialize authentication state\n  useEffect(() => {\n    const initializeAuth = () => {\n      const storage = getLocalStorage();\n      if (storage) {\n        const token = storage.getItem(TOKEN_KEY);\n        if (token && !isTokenExpired(token)) {\n          const decodedToken = parseJwt(token);\n          if (decodedToken) {\n            setUser({\n              token,\n              username: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.sub,\n              role: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.role,\n              id: (decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.userId) || (decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.id),\n              email: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.email\n            });\n            setIsAuthenticated(true);\n          } else {\n            // Invalid token, clear it\n            storage.removeItem(TOKEN_KEY);\n          }\n        } else if (token && isTokenExpired(token)) {\n          // Token expired, clear it\n          storage.removeItem(TOKEN_KEY);\n        }\n      }\n      setLoading(false);\n    };\n    initializeAuth();\n  }, []);\n\n  // Set up token expiration check\n  useEffect(() => {\n    if (!user || !user.token) return;\n    const checkTokenExpiration = () => {\n      if (isTokenExpired(user.token)) {\n        logout();\n      }\n    };\n\n    // Check every minute\n    const interval = setInterval(checkTokenExpiration, 60000);\n    return () => clearInterval(interval);\n  }, [user]);\n  const login = useCallback(token => {\n    const storage = getLocalStorage();\n    if (storage) {\n      storage.setItem(TOKEN_KEY, token);\n    }\n    const decodedToken = parseJwt(token);\n    if (decodedToken) {\n      const userData = {\n        token,\n        username: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.sub,\n        role: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.role,\n        id: (decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.userId) || (decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.id),\n        email: decodedToken === null || decodedToken === void 0 ? void 0 : decodedToken.email\n      };\n      setUser(userData);\n      setIsAuthenticated(true);\n      return userData;\n    } else {\n      throw new Error('Invalid token format');\n    }\n  }, []);\n  const logout = useCallback(() => {\n    const storage = getLocalStorage();\n    if (storage) {\n      storage.removeItem(TOKEN_KEY);\n    }\n    setUser(null);\n    setIsAuthenticated(false);\n  }, []);\n  const hasRole = useCallback(role => {\n    return (user === null || user === void 0 ? void 0 : user.role) === role;\n  }, [user]);\n  const hasAnyRole = useCallback(roles => {\n    return roles.includes(user === null || user === void 0 ? void 0 : user.role);\n  }, [user]);\n  const updateUser = useCallback(userData => {\n    if (user) {\n      setUser(prevUser => ({\n        ...prevUser,\n        ...userData\n      }));\n    }\n  }, [user]);\n  const value = {\n    user,\n    loading,\n    isAuthenticated,\n    login,\n    logout,\n    hasRole,\n    hasAnyRole,\n    updateUser\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 156,\n    columnNumber: 9\n  }, this);\n}\n_s(AuthProvider, \"W2gIJvmxkHFvjGaWPG60xnyIH1k=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","useCallback","jsxDEV","_jsxDEV","AuthContext","TOKEN_KEY","process","env","REACT_APP_TOKEN_KEY","getLocalStorage","window","localStorage","parseJwt","token","base64Url","split","base64","replace","jsonPayload","decodeURIComponent","atob","map","c","charCodeAt","toString","slice","join","JSON","parse","error","console","isTokenExpired","decoded","exp","currentTime","Math","floor","Date","now","AuthProvider","children","_s","user","setUser","loading","setLoading","isAuthenticated","setIsAuthenticated","initializeAuth","storage","getItem","decodedToken","username","sub","role","id","userId","email","removeItem","checkTokenExpiration","logout","interval","setInterval","clearInterval","login","setItem","userData","Error","hasRole","hasAnyRole","roles","includes","updateUser","prevUser","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/EMS/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import { createContext, useState, useEffect, useCallback } from \"react\";\r\n\r\nexport const AuthContext = createContext();\r\n\r\nconst TOKEN_KEY = process.env.REACT_APP_TOKEN_KEY || \"auth_token\";\r\n\r\n// Helper to safely access localStorage\r\nconst getLocalStorage = () => {\r\n    if (typeof window !== \"undefined\" && window.localStorage) {\r\n        return window.localStorage;\r\n    }\r\n    return null;\r\n};\r\n\r\n// Parse JWT token to get user info\r\nconst parseJwt = (token) => {\r\n    try {\r\n        const base64Url = token.split('.')[1];\r\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {\r\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\r\n        }).join(''));\r\n        return JSON.parse(jsonPayload);\r\n    } catch (error) {\r\n        console.error('Error parsing JWT token:', error);\r\n        return null;\r\n    }\r\n};\r\n\r\n// Check if token is expired\r\nconst isTokenExpired = (token) => {\r\n    try {\r\n        const decoded = parseJwt(token);\r\n        if (!decoded || !decoded.exp) return true;\r\n        \r\n        // Check if expiration time is in the past (in seconds)\r\n        const currentTime = Math.floor(Date.now() / 1000);\r\n        return decoded.exp < currentTime;\r\n    } catch (error) {\r\n        console.error('Error checking token expiration:', error);\r\n        return true;\r\n    }\r\n};\r\n\r\nexport function AuthProvider({ children }) {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n\r\n    // Initialize authentication state\r\n    useEffect(() => {\r\n        const initializeAuth = () => {\r\n            const storage = getLocalStorage();\r\n            if (storage) {\r\n                const token = storage.getItem(TOKEN_KEY);\r\n                if (token && !isTokenExpired(token)) {\r\n                    const decodedToken = parseJwt(token);\r\n                    if (decodedToken) {\r\n                        setUser({\r\n                            token,\r\n                            username: decodedToken?.sub,\r\n                            role: decodedToken?.role,\r\n                            id: decodedToken?.userId || decodedToken?.id,\r\n                            email: decodedToken?.email\r\n                        });\r\n                        setIsAuthenticated(true);\r\n                    } else {\r\n                        // Invalid token, clear it\r\n                        storage.removeItem(TOKEN_KEY);\r\n                    }\r\n                } else if (token && isTokenExpired(token)) {\r\n                    // Token expired, clear it\r\n                    storage.removeItem(TOKEN_KEY);\r\n                }\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        initializeAuth();\r\n    }, []);\r\n\r\n    // Set up token expiration check\r\n    useEffect(() => {\r\n        if (!user || !user.token) return;\r\n\r\n        const checkTokenExpiration = () => {\r\n            if (isTokenExpired(user.token)) {\r\n                logout();\r\n            }\r\n        };\r\n\r\n        // Check every minute\r\n        const interval = setInterval(checkTokenExpiration, 60000);\r\n        \r\n        return () => clearInterval(interval);\r\n    }, [user]);\r\n\r\n    const login = useCallback((token) => {\r\n        const storage = getLocalStorage();\r\n        if (storage) {\r\n            storage.setItem(TOKEN_KEY, token);\r\n        }\r\n        \r\n        const decodedToken = parseJwt(token);\r\n        if (decodedToken) {\r\n            const userData = {\r\n                token,\r\n                username: decodedToken?.sub,\r\n                role: decodedToken?.role,\r\n                id: decodedToken?.userId || decodedToken?.id,\r\n                email: decodedToken?.email\r\n            };\r\n            setUser(userData);\r\n            setIsAuthenticated(true);\r\n            return userData;\r\n        } else {\r\n            throw new Error('Invalid token format');\r\n        }\r\n    }, []);\r\n\r\n    const logout = useCallback(() => {\r\n        const storage = getLocalStorage();\r\n        if (storage) {\r\n            storage.removeItem(TOKEN_KEY);\r\n        }\r\n        setUser(null);\r\n        setIsAuthenticated(false);\r\n    }, []);\r\n\r\n    const hasRole = useCallback((role) => {\r\n        return user?.role === role;\r\n    }, [user]);\r\n\r\n    const hasAnyRole = useCallback((roles) => {\r\n        return roles.includes(user?.role);\r\n    }, [user]);\r\n\r\n    const updateUser = useCallback((userData) => {\r\n        if (user) {\r\n            setUser(prevUser => ({ ...prevUser, ...userData }));\r\n        }\r\n    }, [user]);\r\n\r\n    const value = {\r\n        user,\r\n        loading,\r\n        isAuthenticated,\r\n        login,\r\n        logout,\r\n        hasRole,\r\n        hasAnyRole,\r\n        updateUser\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}